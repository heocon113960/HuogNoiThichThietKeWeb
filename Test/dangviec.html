<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ƒêƒÉng Tuy·ªÉn D·ª•ng</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(to right, #e0f7fa, #ffffff);
      margin: 0;
      padding: 0;
    }

    .tmteam-logo {
      position: fixed;
      top: 15px;
      left: 20px;
      font-weight: bold;
      font-size: 20px;
      color: #0073e6;
      z-index: 999;
    }

    .container {
      max-width: 500px;
      margin: 80px auto 50px;
      background-color: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    h2 {
      text-align: center;
      color: #0073e6;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: #333;
      font-size: 15px;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 12px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      box-sizing: border-box;
      transition: all 0.3s ease;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    input[type="text"]:focus, textarea:focus {
      border-color: #0073e6;
      box-shadow: 0 0 5px rgba(0,115,230,0.3);
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(to right, #0073e6, #00bcd4);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      font-weight: bold;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 20px;
    }

    button:hover {
      background-color: #005bb5;
    }

    .note {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-top: 10px;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }

    .shake {
      animation: shake 0.3s;
      border-color: red;
    }

    #suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      max-height: 150px;
      overflow-y: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 1000;
      display: none;
    }

    #suggestions li {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s ease;
    }

    #suggestions li:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
<div class="tmteam-logo">TMTeam</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<div class="container">
  <h2>ƒêƒÉng Tin Tuy·ªÉn D·ª•ng</h2>
  <form id="postJobForm">
    <label for="tenCV">T√™n c√¥ng vi·ªác</label>
    <input type="text" id="tenCV" placeholder="VD: Nh√¢n vi√™n b√°n h√†ng" required>

    <label for="tenCT">T√™n c√¥ng ty</label>
    <input type="text" id="tenCT" placeholder="VD: TMTeam Vi·ªát Nam" required>

    <div id="map" style="height: 300px; margin: 20px 0; border-radius: 10px;"></div>

    <label for="diachi">ƒê·ªãa ch·ªâ (t√πy ch·ªçn)</label>
    <div style="position: relative;">
      <input type="text" id="diachi" placeholder="VD: 60/18A Hu·ª≥nh Kh∆∞∆°ng An" />
      <ul id="suggestions"></ul>
    </div>
<button type="button" onclick="layViTriHienTai()" style="margin-top:10px;">üìç Ch·ªçn v·ªã tr√≠ hi·ªán t·∫°i</button>

    <input type="hidden" id="lat">
    <input type="hidden" id="lng">

    <label for="luong">L∆∞∆°ng</label>
    <input type="text" id="luong" placeholder="VD: 8.000.000 VNƒê" required>

    <label for="chitiet">Th√¥ng tin chi ti·∫øt</label>
    <textarea id="chitiet" placeholder="M√¥ t·∫£ c√¥ng vi·ªác, y√™u c·∫ßu, quy·ªÅn l·ª£i..." rows="5"></textarea>

    <label for="ttlh">Th√¥ng tin li√™n h·ªá</label>
    <input type="text" id="ttln" placeholder="Email ho·∫∑c S·ªë ƒêi·ªán Tho·∫°i" required>


    <button type="submit">ƒêƒÉng tuy·ªÉn</button>
  </form>
  <p class="note">Th√¥ng tin s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ngay sau khi ƒëƒÉng.</p>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


<script>
  function layViTriHienTai() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      const lat = position.coords.latitude.toFixed(6);
      const lng = position.coords.longitude.toFixed(6);

      document.getElementById("lat").value = lat;
      document.getElementById("lng").value = lng;

      const latlng = L.latLng(lat, lng);
      map.setView(latlng, 15);

      if (marker) {
        marker.setLatLng(latlng);
      } else {
        marker = L.marker(latlng).addTo(map);
      }

      marker.bindPopup(`V·ªã tr√≠ hi·ªán t·∫°i:<br>Lat: ${lat}<br>Lng: ${lng}`).openPopup();

      layDiaChiTuToaDo(lat, lng);
    }, function(error) {
      alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠: " + error.message);
    });
  } else {
    alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
  }
}

document.getElementById("postJobForm").onsubmit = function (e) {
  e.preventDefault();

  const tenCV = document.getElementById("tenCV").value.trim();
  const tenCT = document.getElementById("tenCT").value.trim();
  const diachiRaw = document.getElementById("diachi").value.trim();
  const luong = document.getElementById("luong").value.trim();
  const chitiet = document.getElementById("chitiet").value.trim();
  const ttln = document.getElementById("ttln").value.trim();
  const lat = parseFloat(document.getElementById("lat").value);
  const lng = parseFloat(document.getElementById("lng").value);

  // Ki·ªÉm tra c√°c tr∆∞·ªùng b·∫Øt bu·ªôc
  if (!tenCV || !tenCT || !luong || !chitiet || !ttln) {
    alert("‚ùå Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc.");
    return;
  }

  // C·∫£nh b√°o n·∫øu ch∆∞a ch·ªçn v·ªã tr√≠
  if (isNaN(lat) || isNaN(lng)) {
    const tiepTuc = confirm("‚ö†Ô∏è B·∫°n ch∆∞a ch·ªçn v·ªã tr√≠ tr√™n b·∫£n ƒë·ªì. Ti·∫øp t·ª•c ƒëƒÉng m√† kh√¥ng c√≥ t·ªça ƒë·ªô?");
    if (!tiepTuc) return;
  }

  // R√∫t g·ªçn ƒë·ªãa ch·ªâ n·∫øu c√≥ t·ª´ 3 ph·∫ßn tr·ªü l√™n
  const diachiParts = diachiRaw.split(",");
  const diachiRutGon = diachiParts.length > 2
    ? diachiParts.slice(0, diachiParts.length - 2).join(",").trim()
    : diachiRaw;

  // T·∫°o ƒë·ªëi t∆∞·ª£ng c√¥ng vi·ªác
  const job = {
    tenCV,
    tenCT,
    diachi: diachiRutGon,
    lat: isNaN(lat) ? null : lat,
    lng: isNaN(lng) ? null : lng,
    luong,
    chitiet,
    ttln,
    duyet: false
  };

  // L∆∞u v√†o localStorage
  const jobs = JSON.parse(localStorage.getItem("jobs")) || [];
  jobs.push(job);
  localStorage.setItem("jobs", JSON.stringify(jobs));

  // Th√¥ng b√°o
  alert(
    `‚úÖ ƒê√£ ƒëƒÉng tuy·ªÉn:\n` +
    `- C√¥ng vi·ªác: ${tenCV}\n` +
    `- C√¥ng ty: ${tenCT}\n` +
    `- ƒê·ªãa ƒëi·ªÉm: ${diachiRutGon || "Kh√¥ng c√≥"}\n` +
    `- L∆∞∆°ng: ${luong}\n` +
    `- Chi ti·∫øt: ${chitiet}\n` +
    `- Li√™n h·ªá: ${ttln}\n` +
    `Tr·∫°ng th√°i: Ch·ªù duy·ªát`
  );

  // H·ªèi ti·∫øp t·ª•c
  const tiepTuc = confirm("B·∫°n c√≥ mu·ªën ƒëƒÉng th√™m b√†i?");
  if (tiepTuc) {
    document.getElementById("postJobForm").reset();
    document.getElementById("suggestions").innerHTML = "";
    document.getElementById("suggestions").style.display = "none";
    if (marker) {
      map.removeLayer(marker);
      marker = null;
    }
    document.getElementById("lat").value = "";
    document.getElementById("lng").value = "";
  } else {
    window.location.href = "test.html";
  }
};

</script>



<script>
let map = L.map('map').setView([10.7769, 106.7009], 13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

let marker;

function layDiaChiTuToaDo(lat, lng) {
  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
    .then(response => response.json())
    .then(data => {
      if (data && data.display_name) {
        document.getElementById("diachi").value = data.display_name;
      }
    });
}

map.on('click', function(e) {
  const lat = e.latlng.lat.toFixed(6);
  const lng = e.latlng.lng.toFixed(6);

  document.getElementById("lat").value = lat;
  document.getElementById("lng").value = lng;

  if (marker) {
    marker.setLatLng(e.latlng);
  } else {
    marker = L.marker(e.latlng).addTo(map);
  }

  marker.bindPopup(`V·ªã tr√≠ ƒë√£ ch·ªçn:<br>Lat: ${lat}<br>Lng: ${lng}`).openPopup();

  const xacNhan = confirm("B·∫°n c√≥ mu·ªën t·ª± ƒë·ªông ƒëi·ªÅn ƒë·ªãa ch·ªâ t·ª´ v·ªã tr√≠ ƒë√£ ch·ªçn?");
  if (xacNhan) {
    layDiaChiTuToaDo(lat, lng);
  }
});
</script>

<script>
function tinhKhoangCach(lat1, lng1, lat2, lng2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
            Math.sin(dLng / 2) * Math.sin(dLng / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

document.getElementById("diachi").addEventListener("input", function () {
  const query = this.value.trim();
  const suggestionsList = document.getElementById("suggestions");
  const lat = parseFloat(document.getElementById("lat").value);
  const lng = parseFloat(document.getElementById("lng").value);

  if ((lat && lng) || query.length < 3) {
    suggestionsList.innerHTML = "";
    suggestionsList.style.display = "none";
    return;
  }

  suggestionsList.style.display = "block";

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&addressdetails=1&limit=10&countrycodes=vn`)
    .then(response => response.json())
    .then(data => {
      const allowedProvinces = ["H·ªì Ch√≠ Minh", "C·∫ßn Th∆°", "B√¨nh D∆∞∆°ng", "ƒê·ªìng Nai", "V≈©ng T√†u", "Long An", "Ti·ªÅn Giang", "B·∫øn Tre"];
      const filtered = data.filter(place => {
        const addrText = place.display_name.toLowerCase();
        const inputText = query.toLowerCase();
        const hasStreet = place.address.road || place.address.street || place.address.house_number;
        const isInAllowedProvince = allowedProvinces.some(p => Object.values(place.address).join(" ").includes(p));
        const isMatch = addrText.includes(inputText);
        return isInAllowedProvince && isMatch && hasStreet;
      });

      if (!filtered.length) {
        suggestionsList.innerHTML = "<li>Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ ph√π h·ª£p.</li>";
        return;
      }

      if (!isNaN(lat) && !isNaN(lng)) {
        filtered.sort((a, b) => {
          const distA = tinhKhoangCach(lat, lng, parseFloat(a.lat), parseFloat(a.lon));
          const distB = tinhKhoangCach(lat, lng, parseFloat(b.lat), parseFloat(b.lon));
          return distA - distB;
        });
      }

      suggestionsList.innerHTML = "";

      filtered.forEach(place => {
        const li = document.createElement("li");
        const parts = place.display_name.split(",");
        li.innerHTML = `<strong>${parts[0]}</strong><br><small>${parts.slice(1).join(",")}</small>`;

        li.onclick = () => {
          document.getElementById("diachi").value = place.display_name;
          document.getElementById("lat").value = place.lat;
          document.getElementById("lng").value = place.lon;
          suggestionsList.innerHTML = "";
          suggestionsList.style.display = "none";

          const latlng = L.latLng(place.lat, place.lon);
          map.setView(latlng, 15);
          if (marker) {
            marker.setLatLng(latlng);
          } else {
            marker = L.marker(latlng).addTo(map);
          }
          marker.bindPopup(`V·ªã tr√≠ ƒë√£ ch·ªçn:<br>Lat: ${place.lat}<br>Lng: ${place.lon}`).openPopup();
        };

        suggestionsList.appendChild(li);
      });
    });
});

// T·ª± ƒë·ªông ch·ªçn g·ª£i √Ω ƒë·∫ßu ti√™n khi nh·∫•n Enter
document.getElementById("diachi").addEventListener("keydown", function (e) {
  const suggestionsList = document.getElementById("suggestions");
  if (e.key === "Enter" && suggestionsList.firstChild) {
    e.preventDefault();
    suggestionsList.firstChild.click();
  }
});
</script>


</body>
</html>
